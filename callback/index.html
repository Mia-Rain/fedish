<body>
<div id="authkey">
</div>
</body>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
var urlParams = new URLSearchParams(window.location.search);
console.log(urlParams.get('code'));
const code = urlParams.get('code');
const CLID = sessionStorage.getItem('CLID');
const CLSEC = sessionStorage.getItem('CLSEC');
const URL = sessionStorage.getItem('URL');

/*TOKEN GEN*/ $.ajax({
  type: "POST",
  url: URL + "/oauth/token",
  headers: { "Content-Type": "application/x-www-form-urlencoded" },
  contentType: "application/x-wwwz-form-urlencoded; charset=utf-8",
  dataType: "json",
  data: {
    client_id: CLID,
    client_secret: CLSEC,
    redirect_uri: "https://thatgeekyweeb.github.io/fedish/callback",
    code,
    grant_type: "authorization_code",
  },
  success: function (response, data) {
    console.log(response);
    console.log(data);
    sessionStorage.setItem("refresh_token", response.refresh_token);
    sessionStorage.setItem("access_token", response.access_token);
  },
});

if (sessionStorage.getItem('refresh_token') == "undefined" && sessionStorage.getItem('access_token')) {
  document.getElementById("authkey").innerText= 'AUTHKEY=' + sessionStorage.getItem('access_token') + '\nCLID=' + CLID + '\nCLSEC=' + CLSEC + '\nURL=' + URL;
  if (document.getElementById("authkey").innerText.includes("null")) {
     document.getElementById("authkey").innerText= 'AUTHKEY=' + sessionStorage.getItem('access_token') + '\nCLID=' + CLID + '\nCLSEC=' + CLSEC + '\nURL=' + URL;
  }
} else {
  window.refresh_token = sessionStorage.getItem('refresh_token');
  document.getElementById("authkey").innerText= 'REKEY=' +sessionStorage.getItem('refresh_token') + '\nCLID=' + CLID + '\nCLSEC=' + CLSEC + '\nURL=' + URL;
  if (document.getElementById("authkey").innerText.includes("null")) {
     document.getElementById("authkey").innerText= 'REKEY=' + sessionStorage.getItem('refresh_token') + '\nCLID=' + CLID + '\nCLSEC=' + CLSEC + '\nURL=' + URL;
  }
}

</script>
